<div class="consulta-wrapper container-fluid">

    <!-- =========================
       FORMULARIO DE BÚSQUEDA
  ========================== -->
    <div *ngIf="formularioBuscar === 0" class="panel-card panel-card--warning h-100 d-flex flex-column">

        <!-- HEADER -->
        <div class="panel-header d-flex align-items-center justify-content-between">
            <div>
                <h3 class="panel-title mb-1">
                    Consulta combinada <span class="panel-title-tag">(Flexible)</span>
                </h3>
                <p class="panel-subtitle mb-0">
                    Seleccione uno o más criterios para realizar la búsqueda.
                </p>
            </div>

        
        </div>

        <!-- BODY -->
        <div class="panel-body flex-grow-1">

            <!-- Mensajes de ayuda -->
            <p class="form-hint form-hint--warning mb-1">
                * Nuevas consultas: seleccione uno o más criterios para realizar la búsqueda.
            </p>
            <p class="form-hint form-hint--info mb-3">
                * En la casilla <strong>Nombre / Identidad</strong> puede ingresar cualquiera de las dos opciones.
            </p>

            <form #buscarGenerales="ngForm" class="row g-3 consulta-form">

                <!-- Nombre / Identidad -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Nombre / Identidad</label>
                        <input type="text" #nombre_id="ngModel" ngModel name="nombre_id"
                            class="form-control form-control-sm" placeholder="Ingrese nombre o identidad" />
                    </div>
                </div>

                <!-- Sangre -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Sangre</label>
                        <p-multiSelect #sangre_="ngModel" ngModel name="sangre_" [options]="arregloSangre"
                            [style]="{ width: '100%' }" defaultLabel="Sangre" optionLabel="sangre" display="chip">
                        </p-multiSelect>
                    </div>
                </div>

                <!-- Sexo -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Sexo</label>
                        <p-multiSelect #sexo_="ngModel" ngModel name="sexo_" [options]="arregloSexo"
                            [style]="{ width: '100%' }" defaultLabel="Sexo" optionLabel="nombreSexo" display="chip">
                        </p-multiSelect>
                    </div>
                </div>

                <!-- Religión -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Religión</label>
                        <p-multiSelect #religion_="ngModel" ngModel name="religion_" [options]="arregloReligion"
                            [style]="{ width: '100%' }" defaultLabel="Religión" optionLabel="religion" display="chip">
                        </p-multiSelect>
                    </div>
                </div>

                <!-- Serie -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Serie</label>
                        <input type="text" name="serie" #serie="ngModel" ngModel class="form-control form-control-sm"
                            placeholder="Ingrese la serie" />
                    </div>
                </div>

                <!-- # Cuenta -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom"># Cuenta</label>
                        <input type="text" name="cuenta" #cuenta="ngModel" ngModel class="form-control form-control-sm"
                            placeholder="Ingrese la cuenta" />
                    </div>
                </div>

                <!-- Combatiente -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Combatiente</label>
                        <p-multiSelect #combatiente_="ngModel" ngModel name="combatiente_"
                            [options]="arregloCombatiente" [style]="{ width: '100%' }" defaultLabel="Combatiente"
                            optionLabel="combatiente" display="chip">
                        </p-multiSelect>
                    </div>
                </div>

                <!-- Usuario -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Usuario</label>
                        <input type="text" name="usuario" #usuario="ngModel" ngModel
                            class="form-control form-control-sm" placeholder="Usuario del sistema" />
                    </div>
                </div>

                <!-- Pasaporte -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Número Pasaporte</label>
                        <input type="text" name="pasaporte" #pasaporte="ngModel" ngModel
                            class="form-control form-control-sm" placeholder="Ingrese pasaporte" />
                    </div>
                </div>

                <!-- Categoria -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Categoría</label>
                        <p-multiSelect #categoria_="ngModel" ngModel name="categoria_" [options]="arregloCategorias"
                            [style]="{ width: '100%' }" defaultLabel="Categoría" optionLabel="categoria" display="chip">
                        </p-multiSelect>
                    </div>
                </div>

                <!-- Grado/Rango -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Grado / Rango</label>
                        <p-multiSelect #grado="ngModel" ngModel name="nombre_grado_" [options]="arregloGrados"
                            [style]="{ width: '100%' }" defaultLabel="Grado / Rango" optionLabel="nombre_grado"
                            display="chip">
                        </p-multiSelect>
                    </div>
                </div>

                <!-- Fuerza -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Fuerza Ingreso</label>
                        <p-multiSelect #fuerza_="ngModel" ngModel name="fuerza_" [options]="arregloFuerzas"
                            [style]="{ width: '100%' }" defaultLabel="Fuerza" optionLabel="nombre" display="chip"
                            (onChange)="sacarunidades(buscarGenerales.value.fuerza_)">
                        </p-multiSelect>
                    </div>
                </div>

                <!-- Unidad -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Unidad</label>
                        <p-multiSelect #unidad_="ngModel" ngModel name="unidad_" [options]="ArregloUnidades"
                            [style]="{ width: '100%' }" defaultLabel="Unidad" optionLabel="unidad" display="chip">
                        </p-multiSelect>
                    </div>
                </div>

                <!-- Armas -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Armas</label>
                        <p-multiSelect #armas_="ngModel" ngModel name="armas_" [options]="arregloarmas"
                            [style]="{ width: '100%' }" defaultLabel="Armas" optionLabel="nombre_arma_concat"
                            display="chip">
                        </p-multiSelect>
                    </div>
                </div>

                <!-- Idiomas -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Idiomas</label>
                        <p-multiSelect #idiomas_="ngModel" ngModel name="idiomas_" [options]="arregloIdiomas"
                            [style]="{ width: '100%' }" defaultLabel="Idiomas" optionLabel="descripcion" display="chip">
                        </p-multiSelect>
                    </div>
                </div>

                <!-- Nivel educativo -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Nivel educativo</label>
                        <p-multiSelect #nivel_profesion="ngModel" ngModel name="nivel_profesion"
                            [options]="arregloNiveles" [style]="{ width: '100%' }" defaultLabel="Nivel educativo"
                            optionLabel="nombreNivel" display="chip"
                            (onChange)="sacarCarreras(buscarGenerales.value.nivel_profesion)">
                        </p-multiSelect>
                    </div>
                </div>

                <!-- Profesión -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Profesión</label>
                        <p-multiSelect #profesion_="ngModel" ngModel name="profesion_" [options]="arregloCarreras"
                            [style]="{ width: '100%' }" defaultLabel="Profesión" optionLabel="profesion" display="chip">
                        </p-multiSelect>
                    </div>
                </div>

                <!-- Cursos -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Cursos</label>
                        <p-multiSelect #cursos_="ngModel" ngModel name="cursos_" [options]="arregloCursos"
                            [style]="{ width: '100%' }" defaultLabel="Cursos" optionLabel="nombre_cursos"
                            display="chip">
                        </p-multiSelect>
                    </div>
                </div>

                <!-- Cumpleañeros -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom">Cumpleañeros (mes)</label>
                        <input type="month" name="fecha" #fecha="ngModel" ngModel
                            class="form-control form-control-sm" />
                    </div>
                </div>

                <!-- Estado (Activos / Bajas) -->
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="form-group-custom">
                        <label class="form-label-custom d-block">Estado</label>
                        <div class="estado-toggle-group">
                            <div class="estado-toggle" (click)="activofn()">
                                <input type="checkbox" [checked]="estado.activos" />
                                <span>Activos</span>
                            </div>
                            <div class="estado-toggle" (click)="bajafn()">
                                <input type="checkbox" [checked]="estado.bajas" />
                                <span>Bajas</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BOTONES -->
                <div class="col-12">
                    <div class="d-flex justify-content-end gap-2 mt-2">
                        <button pButton type="button" (click)="buscar(buscarGenerales)" label="Buscar"
                            style="background-color: black; color: white; border-radius: 20px;height: 50px;"
                            iconPos="left">
                            <i class="pi pi-search"></i> Buscar
                        </button>

                        <button pButton type="button" (click)="limpiar(buscarGenerales)" label="Limpiar"
                            style="background-color: rgb(38, 116, 31); color: white; border-radius: 20px;height: 50px;"
                            styleClass="btn-pill btn-pill-danger">
                            <i class="pi pi-filter-slash"></i> Limpiar
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- =========================
       RESULTADOS
  ========================== -->
 <div *ngIf="formularioBuscar === 5"
     class="panel-card panel-card--danger h-100 d-flex flex-column mt-3 mt-md-0">

  <!-- =========================
       HEADER
  ========================== -->
  <div class="panel-header d-flex align-items-center justify-content-between">
    <div class="d-flex align-items-center gap-2">

      <!-- Botón atrás -->
      <button
        pButton
        type="button"
        (click)="atras(0)"
        title="Atrás"
        icon="pi pi-arrow-left"
        styleClass="btn-icon-ghost">
      </button>

      <div>
        <h3 class="panel-title mb-0">Resultados de la consulta combinada</h3>
      </div>
    </div>

    <div class="d-flex align-items-center">
      <!-- Exportar -->
      <button
        pButton
        type="button"
        (click)="exportexcel2('tabla-resultado_1')"
        label="Exportar"
        icon="pi pi-file-excel"
        iconPos="left"
        styleClass="btn-pill btn-pill-success">
      </button>
    </div>
  </div>

  <!-- =========================
       BODY
  ========================== -->
  <div class="panel-body flex-grow-1 d-flex flex-column">

    <!-- Filtro + cantidad de filas -->
    <div class="row align-items-center mb-2">

      <div class="col-12 col-md-4">
        <span class="result-count">
          Resultados:
          <strong>{{ arregloResultadoFiltrado.length | currency : '' : '' }}</strong>
        </span>
      </div>

      <div class="col-12 col-md-8 mt-2 mt-md-0 d-flex justify-content-md-end">
        <span class="p-input-icon-left filtro-box">
          <i class="pi pi-search"></i>
          <input
            pInputText
            type="text"
            [(ngModel)]="filtroTexto"
            (ngModelChange)="aplicarFiltro()"
            placeholder="Filtrar por nombre, identidad, unidad..."
          />
        </span>
      </div>

    </div>

    <!-- =========================
         TABLA RESULTADOS
    ========================== -->
    <div class="results-table-wrapper flex-grow-1">

      <table
        id="tabla-resultado_1"
        class="table table-sm table-hover table-bordered mb-0 align-middle table-resultados">

        <thead class="table-light">
          <tr>
            <th>Opt</th>
            <th>Foto</th>
            <th>Cuenta</th>
            <th>Identidad</th>
            <th>Grado</th>
            <th>Arma</th>
            <th>Categoría</th>
            <th>Nombres</th>
            <th>Apellidos</th>
            <th>Cargo</th>
            <th>Serie</th>
            <th>Estado</th>
            <th>Combatiente</th>
            <th>Asignación</th>
            <th>Fecha Asignación</th>
            <th>Tiempo Asignación</th>
            <th>Pasaporte</th>
            <th>Religión</th>
            <th>Sangre</th>
            <th>Género</th>
            <th>Fecha Nacimiento</th>
            <th>Edad</th>
            <th>Idioma</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let i of arregloResultadoFiltrado">

            <!-- Ver perfil -->
            <td class="text-center">
              <i class="pi pi-eye text-primary cursor-pointer"
                 (click)="verPerfil(i)">
              </i>
            </td>

            <!-- Foto -->
            <td class="text-center">
              <img
                class="foto-mini sombra"
                [src]="_ServiciosSiapffaaService.url2 + 'sacarfoto/' + i?.foto"
                alt="Foto"
              />
            </td>

            <td>{{ i.cuenta }}</td>
            <td>{{ i.identidad }}</td>
            <td>{{ i.grado }}</td>
            <td>{{ i.nombre_arma }}</td>
            <td>{{ i.categoria }}</td>
            <td>{{ i.nombre }}</td>
            <td>{{ i.apellido }}</td>
            <td>{{ i.Nombre_Puesto }}</td>
            <td>{{ i.serie }}</td>

            <td [ngClass]="i.activo === 1 ? 'text-primary' : 'text-danger'">
              {{ i.activo === 1 ? 'Activo' : 'Baja' }}
            </td>

            <td>{{ i.combatiente === 1 ? 'Sí': 'No' }}</td>
            <td>{{ i.unidad_asignado }}</td>
            <td>{{ i.fecha_asignacion | date : 'yyyy-MM-dd' : 'UTC' }}</td>

            <td>
              {{ i.tiempo_asignacion <= 1
                ? i.tiempo_asignacion + ' Año'
                : i.tiempo_asignacion + ' Años' }}
            </td>

            <td>{{ i.pasaporte }}</td>
            <td>{{ i.religion }}</td>
            <td>{{ i.sangre }}</td>
            <td>{{ i.sexo }}</td>
            <td>{{ i.fecha_nacimiento | date : 'yyyy-MM-dd' : 'UTC' }}</td>
            <td>{{ i.edad }}</td>
            <td>{{ i.idiomas }}</td>

          </tr>
        </tbody>

      </table>

    </div>

  </div>
</div>

<div *ngIf="formularioBuscar === 3">
     <div class="d-flex align-items-center gap-2">

      <!-- Botón atrás -->
      <button
        pButton
        type="button"
        (click)="atras(5)"
        title="Atrás"
        icon="pi pi-arrow-left"
        styleClass="btn-icon-ghost">
      </button>

       
    </div>
     <app-visualizar-perfil [identidad]="personaSelecionada.identidad" > </app-visualizar-perfil>
</div>
</div>