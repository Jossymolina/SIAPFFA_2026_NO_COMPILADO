<div class="shell">

  <!-- HEADER -->
  <div class="topbar">
    <div class="title-wrap">
      <div class="dot"></div>
      <div>
        <div class="title">Reportes</div>
        <div class="subtitle">Menú para las unidades/bases</div>
      </div>
    </div>

    <!-- ✅ CORREGIDO: NO usar [(ngModel)]="q()" -->
    <div class="search">
      <span class="p-input-icon-left w-100">
        
        <input
          pInputText
          class="w-100"
          [ngModel]="q()"
          (ngModelChange)="q.set($event)"
          placeholder="Buscar reporte..."
          style="background-color: black;"
        />
      </span>
    </div>
  </div>

  <!-- FILTROS -->
  <div class="filters">
    <div class="filters-scroll">
      <button
        type="button"
        class="chip"
        *ngFor="let c of categorias()"
        [class.active]="categoria() === c"
        (click)="seleccionarCategoria(c)"
        
        >
        <i class="pi pi-tag"></i>
        <span>{{ c }}</span>
      </button>
    </div>

    <button type="button" class="btn-clear" (click)="limpiar()" pTooltip="Limpiar filtros">
      <i class="pi pi-times"></i>
    </button>
  </div>

  <!-- GRID (Bootstrap SOLO GRID) -->
  <div class="container-fluid" *ngIf="!VentanaSeleccionada">
    <div class="row g-3">
      <div class="col-6 col-md-4 col-lg-3 col-xl-2" *ngFor="let r of filtrados()">
        <p-card styleClass="app-card" (click)="abrir(r)">
          <ng-template pTemplate="content">
            <div class="app">
              <div class="icon-box">
                <i class="pi app-icon" [ngClass]="r.icon"></i>
              </div>

              <div class="app-title" [title]="r.titulo">{{ r.titulo }}</div>
              <div class="app-desc" *ngIf="r.descripcion">{{ r.descripcion }}</div>

              <div class="app-footer">
                <span class="cat">
                  <i class="pi pi-folder"></i> {{ r.categoria }}
                </span>
                <i class="pi pi-angle-right go"></i>
              </div>
            </div>
          </ng-template>
        </p-card>
      </div>
    </div>
  </div>
 
@if(VentanaSeleccionada?.id==='r1'){
  <div>
     <div class="container-fluid py-3">

  <!-- HEADER -->
  <div class="row align-items-center mb-3">
    <div class="col">
      <h5 class="mb-0">Parte de su unidad</h5>
      <small class="text-muted">{{usuarioLoguiado.unidad}}</small>
    </div>

    <div class="col-auto">
      <button
        class="btn btn-sm btn-success"
        (click)="exportarExcelResumen('tablaResumen')">
        <i class="bi bi-file-earmark-excel me-1"></i>
        Exportar
      </button>
    </div>
  </div>

 

  <!-- TABLA -->
  <div class="table-responsive"  >
    <label for="">Total {{ sumarPropiedad(arregloResumenParteUnidad,'cantidad')   }}</label>
  <table id="tablaResumen" class="table table-bordered table-hover table-sm align-middle">
      <thead class="table-light">
        <tr>
          <th style="width:60px">#</th>
          <th>Grado</th>
          <th class="text-end" style="width:120px">Cantidad</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let r of arregloResumenParteUnidad; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ r.nombre_grado }}</td>
          <td class="text-end fw-bold">
            {{ r.cantidad }}
          </td>
        </tr>

        <tr *ngIf="arregloResumenParteUnidad?.length === 0">
          <td colspan="3" class="text-center text-muted py-3">
            No hay datos para mostrar
          </td>
        </tr>
      </tbody>

     
    </table>
  </div>

</div>

 <div class="container-fluid py-3">

  <!-- HEADER -->
  <div class="row align-items-center mb-3">
   

    <div class="col-auto">
      <button
        class="btn btn-sm btn-success"
        (click)="exportarExcelResumen('tablaList')">
        <i class="bi bi-file-earmark-excel me-1"></i>
        Exportar
      </button>
    </div>
  </div>

 

  <!-- TABLA -->
  <div class="table-responsive"  >
 


        <table id="tablaList" class="table table-bordered table-hover table-sm align-middle">
      <thead class="table-light">
        <tr>
          <th style="width:60px">#</th>
          <th>Identidad</th>
          <th>Grado</th>
          <th>Nombres</th>
          <th>Cuenta Banco</th>
          <th>Sexo</th>
          <th>Fecha Ingreso</th>
          <th>Fecha Ascenso</th>
          <th>Fecha Asignación</th>
       


         
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let r of arregloListaParteUnidad; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ r.identidad }}</td>
          <td>{{ r.grado }}</td>
            <td>{{ r.nombres }}</td>
          <td>{{ r.cuenta_banco }}</td>
         
          <td>{{ r.sexo }}</td>
          <td>{{ r.fecha_ingreso   | date: 'dd/MM/yyyy' }}</td>
          <td>{{ r.fecha_ascenso  | date: 'dd/MM/yyyy'   }}</td>
          <td>{{ r.fecha_asignacion  | date: 'dd/MM/yyyy'  }}</td>

 
        </tr>

        <tr *ngIf="arregloListaParteUnidad?.length === 0">
          <td colspan="3" class="text-center text-muted py-3">
            No hay datos para mostrar
          </td>
        </tr>
      </tbody>

     
    </table>
  </div>

</div>


  </div>
}


@if(VentanaSeleccionada?.id==='r2'){
  <div>
     <div class="container-fluid py-3">
  <form
  #formBuscar="ngForm"
  >
            <label for="">Fecha
            <br>
            <input type="month"  
            name="fecha" #fecha="ngModel" ngModel
          required
            class="form-control"  >
        </label>
         <label for="" style="margin-left: 10px;">
            <button 
               [disabled]="!formBuscar.valid"
            class="btn btn-sm btn-primary" (click)="sacarBajas(formBuscar)">Buscar</button>
        </label>

  </form>
   
  <div class="row align-items-center mb-3">
    <div class="col">
      <h5 class="mb-0">Parte de bajas</h5>
      <small class="text-muted">{{usuarioLoguiado.unidad}}</small>
    </div>

    <div class="col-auto">
      <button
        class="btn btn-sm btn-success"
        (click)="exportarExcelResumen('tablaResumen')">
        <i class="bi bi-file-earmark-excel me-1"></i>
        Exportar
      </button>
    </div>
  </div>

 

  <!-- TABLA -->
  <div class="table-responsive"  >
    <label for="">Total {{  arregloBajas.length }}</label>
  <table id="tablaResumen" class="table table-bordered table-hover table-sm align-middle">
      <thead class="table-light">
        <tr>
          <th style="width:60px">#</th>
          <th>Identidad</th>
          <th>Nombres</th>
          <th>Grado</th>
          <th>Fecha Ingreso</th>
          <th>Fecha Baja</th>
          <th>Fecha de Ejecucion</th>
         <th>Tipo Baja</th>  
         <th>Unidad</th>  
         <th>Observación</th>
         
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let r of arregloBajas; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ r.identidad }}</td>
          <td>{{ r.nombres }}</td>
          <td>{{ r.grado }}</td>
          <td>{{ r.fecha | date: 'dd/MM/yyyy':"UTC-6" }}</td>
          <td>{{ r.fecha_de_baja | date: 'dd/MM/yyyy':"UTC-6" }}</td>
          <td>{{ r.fecha_sistema | date: 'dd/MM/yyyy hh:mm:ss':"UTC-6" }}</td>
          <td>{{ r.tipo_baja }}</td>
          <td>{{ r.asignacion }}</td>
          <td>{{ r.observacion }}</td>


         
        </tr>

        <tr *ngIf="arregloBajas?.length === 0">
          <td colspan="10" class="text-center text-muted py-3">
            No hay datos para mostrar
          </td>
        </tr>
      </tbody>

     
    </table>
  </div>

</div>
 


  </div>
}

@if(VentanaSeleccionada?.id==='r3'){
  <div>
     <div class="container-fluid py-3">
  <form
  #formBuscar="ngForm"
  >
            <label for="">Fecha
            <br>
            <input type="month"  
            name="fecha" #fecha="ngModel" ngModel
          required
            class="form-control"  >
        </label>
         <label for="" style="margin-left: 10px;">
            <button 
               [disabled]="!formBuscar.valid"
            class="btn btn-sm btn-primary" (click)="sacarCambioCategoria(formBuscar)">Buscar</button>
        </label>

  </form>
   
  <div class="row align-items-center mb-3">
    <div class="col">
      <h5 class="mb-0">Parte de cambios de categoria</h5>
      <small class="text-muted">{{usuarioLoguiado.unidad}}</small>
    </div>

    <div class="col-auto">
      <button
        class="btn btn-sm btn-success"
        (click)="exportarExcelResumen('tablaCambio')">
        <i class="bi bi-file-earmark-excel me-1"></i>
        Exportar
      </button>
    </div>
  </div>

 

  <!-- TABLA -->
  <div class="table-responsive"  >
    <label for="">Total {{  arregloCambioCategoria.length }}</label>
  <table id="tablaCambio" class="table table-bordered table-hover table-sm align-middle">
      <thead class="table-light">
        <tr>
          <th style="width:60px">#</th>
          <th>Identidad</th>
          <th>Nombres</th>
          <th>Grado</th>
          <th>Fecha Ingreso</th>
          <th>Fecha que Cambio</th>
      
         
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let r of arregloCambioCategoria; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ r.identidad }}</td>
          <td>{{ r.nombre }}</td>
          <td>{{ r.nombre_grado }}</td>
          <td>{{ r.fecha_ingreso | date: 'dd/MM/yyyy':"UTC-6" }}</td>
          <td>{{ r.fecha_cambio_cat | date: 'dd/MM/yyyy':"UTC-6" }}</td>
        


         
        </tr>

        <tr *ngIf="arregloCambioCategoria?.length === 0">
          <td colspan="7" class="text-center text-muted py-3">
            No hay datos para mostrar
          </td>
        </tr>
      </tbody>

     
    </table>
  </div>

</div>
 


  </div>
}
</div>
